## 系统设计
现有系统有亿级的活跃用户，如何实现日活统计，为了增强用户粘性，要上线一个连续打卡发送积分的功能，怎么实现连续打卡用户统计。

通过 bitmap 存储每天上线的用户数据，从0开始上亿后内存占用大概在几十上百兆，offset偏移量存储。

若用户id最少在20位可以减去最小用户id，用偏移量

setbit login:2021:02:03 10000000 1

并且可以通过 bitcount 统计每天日活用户

通过多个key 做与预算得到一个连续打卡多天的bitmap 

## redis 为什么快
- 优化的数据结构：Redis有诸多可以直接应用的优化数据结构的实现，应用层可以直接使用原生的数据结构提升性能
  - 所有在redis 中的键值对存在一个字典中，字典中有两个哈希表，一个存储值一个做rehash 用
  - 哈希表中的节点存储了实际的键值对
  - key 有动态字符串保存，value 由redisObject 保存
  - 由redisObject 里有type, encoding, lru, refCount, 指向实际对象的指针组成。
  - type 是用来约束客户端的api；encoding 是value 值的实际存储结构；lru 是关于内存淘汰的
  - refCount 用于内存回收机制引用计数法； ptr 指向实际值的指针；
- 基于内存的操作，没有磁盘IO 上的开销
- 单线程不会有上下文切换来带的资源开销
- epoll 多路复用，非阻塞IO